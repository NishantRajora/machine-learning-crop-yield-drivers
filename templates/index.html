<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Crop Yield Intelligence</title>
    <style>
        :root {
            --primary: #2ecc71;
            --bg: #f0f2f5;
            --text: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            transition: background-image 0.8s ease-in-out;
        }

        .container {
            width: 950px;
            /* Slightly transparent white so the crop image shows through subtly */
            background: rgba(255, 255, 255, 0.9);
            background-size: cover;
            background-position: center;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            position: relative;
            transition: background-image 0.8s ease-in-out;
        }

        /* Ensuring inputs remain readable over background images */
        .input-group input,
        .input-group select {
            background: rgba(255, 255, 255, 0.9);
        }

        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(240, 240, 240, 0.5);
            padding-bottom: 10px;
            margin-bottom: 30px;
        }

        h2 {
            color: var(--primary);
            margin: 0;
            text-shadow: 1px 1px 2px white;
        }

        .menu-container {
            position: relative;
        }

        .three-dots {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            font-size: 20px;
            cursor: pointer;
            color: #95a5a6;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 45px;
            background: white;
            border-radius: 8px;
            z-index: 100;
            min-width: 200px;
            border: 1px solid #ddd;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .dropdown-menu button {
            width: 100%;
            text-align: left;
            padding: 12px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
        }

        .dropdown-menu button:hover {
            background: #f8f9fa;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: #2c3e50;
            text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.8);
        }

        input,
        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #edf2f7;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 0.95rem;
        }

        .btn-predict {
            background: var(--primary);
            color: white;
            width: 100%;
            padding: 16px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
        }

        .nutrient-section {
            background: rgba(248, 250, 252, 0.7);
            padding: 20px;
            border-radius: 12px;
            border: 1px dashed #cbd5e1;
            backdrop-filter: blur(2px);
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            background: rgba(241, 255, 246, 0.9);
            border: 2px solid #2ecc71;
            border-radius: 15px;
            text-align: center;
        }
    </style>
</head>

<body>

    <div class="container" id="formContainer">
        <div class="header-section">
            <h2>ðŸŒ± Crop Yield Intelligence</h2>
            <div class="menu-container">
                <button class="three-dots" onclick="toggleMenu()">â‹®</button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <button onclick="fillSampleData()">ðŸ§ª Load Sample Data</button>
                    <button onclick="window.location.href='/'">ðŸ”„ Reset Form</button>
                </div>
            </div>
        </div>

        <form action="/predict" method="POST">
            <div class="grid">
                <div>
                    <div class="input-group">
                        <label>State</label>
                        <select name="State" id="State" required>
                            <option value="" disabled {% if not inputs.State %}selected{% endif %}>Select State</option>
                            {% for s in states %}
                            <option value="{{s}}" {% if inputs.State==s %}selected{% endif %}>{{s}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Crop</label>
                        <select name="Crop" id="Crop" required onchange="updateCropBackground()">
                            <option value="" disabled {% if not inputs.Crop %}selected{% endif %}>Select Crop</option>
                            {% for c in crops %}
                            <option value="{{c}}" {% if inputs.Crop==c %}selected{% endif %}>{{c}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Season</label>
                        <select name="Season" id="Season" required onchange="updateSeasonBackground()">
                            <option value="" disabled {% if not inputs.Season %}selected{% endif %}>Select Season
                            </option>
                            {% for sea in seasons %}
                            <option value="{{sea}}" {% if inputs.Season==sea %}selected{% endif %}>{{sea}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Year</label>
                        <input type="number" name="Year" id="Year" value="{{ inputs.Year }}" placeholder="e.g. 1966"
                            required>
                    </div>
                    <div class="input-group">
                        <label>Temperature (Â°C)</label>
                        <input type="number" step="any" name="Temp" id="Temp" value="{{ inputs.Temp }}"
                            placeholder="e.g. 25" required>
                    </div>
                    <div class="input-group">
                        <label>Rainfall (mm)</label>
                        <input type="number" step="any" name="Rainfall" id="Rainfall" value="{{ inputs.Rainfall }}"
                            placeholder="e.g. 1200" required>
                    </div>
                </div>

                <div class="nutrient-section">
                    <div class="input-group">
                        <label>Nitrogen (N)</label>
                        <input type="number" step="any" name="N" id="N" value="{{ inputs.N }}" placeholder="e.g. 8.44"
                            required>
                    </div>
                    <div class="input-group">
                        <label>Phosphorus (P)</label>
                        <input type="number" step="any" name="P" id="P" value="{{ inputs.P }}" placeholder="e.g. 4.05"
                            required>
                    </div>
                    <div class="input-group">
                        <label>Potassium (K)</label>
                        <input type="number" step="any" name="K" id="K" value="{{ inputs.K }}" placeholder="e.g. 7.43"
                            required>
                    </div>
                    <div class="input-group">
                        <label>Soil pH</label>
                        <input type="number" step="any" name="pH" id="pH" value="{{ inputs.pH }}" placeholder="e.g. 6.5"
                            required>
                    </div>
                    <div class="input-group">
                        <label>Area (ha)</label>
                        <input type="number" step="any" name="Area_ha" id="Area_ha" value="{{ inputs.Area_ha }}"
                            placeholder="e.g. 548000" required>
                    </div>
                </div>
            </div>
            <button type="submit" class="btn-predict">Analyze & Predict Yield</button>
        </form>

        {% if prediction %}
        <div class="result">
            <h3 style="margin:0; font-size: 1.8rem; color: #155724;"><strong>{{ prediction }} kg/ha</strong></h3>
        </div>
        {% endif %}
    </div>

    <script>
        function toggleMenu() {
            const menu = document.getElementById('dropdownMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        // Logic for Page Background based on Season
        function updateSeasonBackground() {
            const season = document.getElementById('Season').value;
            let imageUrl = "";

            switch (season) {
                case "Kharif":
                    // Lush green fields with monsoon clouds
                    imageUrl = "https://images.unsplash.com/photo-1502333302334-44b82772739e?q=80&w=1920&auto=format&fit=crop";
                    break;
                case "Rabi":
                    // Morning mist over winter crops
                    imageUrl = "https://images.unsplash.com/photo-1470240731273-7821a6eeb6bd?q=80&w=1920&auto=format&fit=crop";
                    break;
                case "Summer":
                    // Bright sun over dry or summer-ready land
                    imageUrl = "https://images.unsplash.com/photo-1473496169904-658ba7c44d8a?q=80&w=1920&auto=format&fit=crop";
                    break;
                case "Whole Year":
                    // Scenic panoramic farmland
                    imageUrl = "https://images.unsplash.com/photo-1500382017468-9049fed747ef?q=80&w=1920&auto=format&fit=crop";
                    break;
                default:
                    imageUrl = "https://images.unsplash.com/photo-1464226184884-fa280b87c399?q=80&w=1920&auto=format&fit=crop";
            }
            document.body.style.backgroundImage = `url('${imageUrl}')`;
        }

        // Logic for Form Background based on Crop
        function updateCropBackground() {
            const crop = document.getElementById('Crop').value.toLowerCase();
            const container = document.getElementById('formContainer');
            let imageUrl = "";

            // Mapping specific images to the requested crops
            if (crop.includes("rice")) {
                // High-res lush green rice terrace
                imageUrl = "https://images.unsplash.com/photo-1536657464919-892534f60d6e?q=80&w=1000&auto=format&fit=crop";
            } else if (crop.includes("maize")) {
                // Bright corn/maize field
                imageUrl = "https://images.unsplash.com/photo-1551754655-cd27e38d2076?q=80&w=1000&auto=format&fit=crop";
            } else if (crop.includes("cotton")) {
                // Close up of soft cotton bolls
                imageUrl = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcROlOevMrSY05u9Ie3cvtGifcYoKUSJS-mIhg&s";
            } else if (crop.includes("chickpea")) {
                // Field of green chickpea plants/pods
                imageUrl = "https://images.unsplash.com/photo-1515942400420-2b98fed1f515?q=80&w=1000&auto=format&fit=crop";
            } else {
                imageUrl = "none";
            }

            if (imageUrl !== "none") {
                // Linear gradient ensures form text remains readable over the image
                container.style.backgroundImage = `linear-gradient(rgba(255,255,255,0.88), rgba(255,255,255,0.88)), url('${imageUrl}')`;
                container.style.backgroundSize = "cover";
                container.style.backgroundPosition = "center";
            } else {
                container.style.backgroundImage = "none";
                container.style.backgroundColor = "white";
            }
        }

        function fillSampleData() {
            document.getElementById('State').value = "Chhattisgarh";
            document.getElementById('Crop').value = "Rice";
            document.getElementById('Season').value = "Rabi";
            document.getElementById('Year').value = 1966;
            document.getElementById('Temp').value = 25;
            document.getElementById('Rainfall').value = 1200;
            document.getElementById('N').value = 8.44;
            document.getElementById('P').value = 4.05;
            document.getElementById('K').value = 7.43;
            document.getElementById('pH').value = 6.5;
            document.getElementById('Area_ha').value = 548000;

            updateSeasonBackground();
            updateCropBackground();
            toggleMenu();
        }

        window.onclick = function (event) {
            if (!event.target.matches('.three-dots')) {
                const menu = document.getElementById('dropdownMenu');
                if (menu && menu.style.display === 'block') menu.style.display = 'none';
            }
        }

        window.onload = function () {
            updateSeasonBackground();
            updateCropBackground();
        };
    </script>
</body>

</html>